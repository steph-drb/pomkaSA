<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>POMKA SA - Dashboard StratÃ©gique Cloud</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;700&family=Orbitron:wght@500;900&display=swap" rel="stylesheet" />
    
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
      :root {
        --bg-color: #0f172a;
        --card-bg: #1e293b;
        --accent-primary: #f43f5e;
        --accent-secondary: #3b82f6;
        --text-main: #f8fafc;
        --text-muted: #94a3b8;
        --success: #10b981;
        --danger: #ef4444;
      }

      * { margin: 0; padding: 0; box-sizing: border-box; }
      body { font-family: "Inter", sans-serif; background-color: var(--bg-color); color: var(--text-main); line-height: 1.6; padding-bottom: 50px; }
      h1, h2, h3 { font-family: "Orbitron", sans-serif; text-transform: uppercase; }
      header { background: linear-gradient(90deg, #0f172a 0%, #331e28 100%); padding: 2rem; border-bottom: 2px solid var(--accent-primary); text-align: center; }
      header h1 { font-size: 2.5rem; color: var(--accent-primary); }
      .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
      .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 40px; }
      .grid-full { grid-column: 1 / -1; }
      .card { background-color: var(--card-bg); border-radius: 12px; padding: 20px; border: 1px solid rgba(255, 255, 255, 0.05); }
      
      /* Style Editable */
      [contenteditable="true"] { outline: none; transition: all 0.2s; border-radius: 4px; }
      [contenteditable="true"]:hover { background: rgba(255, 255, 255, 0.05); }
      [contenteditable="true"]:focus { background: rgba(59, 130, 246, 0.1); box-shadow: 0 0 0 2px var(--accent-secondary); }

      ul { list-style: none; }
      li { margin-bottom: 8px; padding-left: 15px; border-left: 2px solid var(--accent-primary); }
      .control-group { margin-bottom: 15px; }
      input[type="range"] { width: 100%; accent-color: var(--accent-primary); }
      .val-display { float: right; color: var(--accent-primary); font-weight: bold; }
      .stat-box { text-align: center; background: rgba(0, 0, 0, 0.2); padding: 10px; border-radius: 8px; margin-top: 10px; }
      .stat-val { font-size: 1.5rem; font-family: "Orbitron"; }
      .profit { color: var(--success); }
      .loss { color: var(--danger); }
      .chart-container { height: 300px; width: 100%; }
      footer { text-align: center; margin-top: 50px; color: var(--text-muted); font-size: 0.8rem; }
      
      #sync-status { font-size: 0.7rem; margin-top: 5px; color: var(--success); opacity: 0; transition: opacity 0.5s; }
    </style>
  </head>
  <body>
    <header>
      <h1>POMKA SA</h1>
      <p>SystÃ¨me Collaboratif Cloud</p>
      <div id="sync-status">âœ“ SynchronisÃ©</div>
    </header>

    <div class="container">
      <div class="grid">
        <div class="grid-full">
          <h2>1. Business Model Canvas</h2>
        </div>
        <div class="card">
          <h3>ðŸ›’ Proposition de Valeur</h3>
          <ul id="list-valeur">
            <li contenteditable="true">AccÃ¨s immÃ©diat (0 attente).</li>
            <li contenteditable="true">Prix "Ami" (< Prix Bar).</li>
            <li contenteditable="true">ExpÃ©rience "Secret Club".</li>
          </ul>
        </div>
        <div class="card">
          <h3>ðŸ‘¥ Segments Clients</h3>
          <ul>
            <li contenteditable="true"><strong>Le Geek Touhou:</strong> Cherche de l'Ã©nergie.</li>
            <li contenteditable="true"><strong>L'Impatient:</strong> DÃ©teste la queue.</li>
          </ul>
        </div>
        <div class="card">
          <h3>ðŸ’° Flux de Revenus</h3>
          <ul>
            <li contenteditable="true">Marge sur "Remboursements".</li>
            <li contenteditable="true">Objectif Marge: > 60%.</li>
          </ul>
        </div>
      </div>

      <div class="grid">
        <div class="grid-full"><h2>2. Simulateur Financier</h2></div>
        <div class="card">
          <div class="control-group">
            <label>CoÃ»t Achat (CHF) <span id="costVal" class="val-display">1.50</span></label>
            <input type="range" id="costInput" min="0.5" max="5" step="0.1" value="1.50" />
          </div>
          <div class="control-group">
            <label>Prix Vente (CHF) <span id="priceVal" class="val-display">5.00</span></label>
            <input type="range" id="priceInput" min="2" max="15" step="0.5" value="5.00" />
          </div>
          <div class="control-group">
            <label>Ventes <span id="salesVal" class="val-display">50</span></label>
            <input type="range" id="salesInput" min="0" max="200" step="5" value="50" />
          </div>
        </div>
        <div class="card">
          <div class="stat-box"><div>BÃ©nÃ©fice Net</div><div class="stat-val profit" id="netProfit">0 CHF</div></div>
        </div>
        <div class="card grid-full"><div class="chart-container"><canvas id="scenarioChart"></canvas></div></div>
      </div>
    </div>

    <footer><p>&copy; 2026 POMKA SA - Moutier, CH.</p></footer>

    <script>
      // CONFIGURATION SUPABASE
      const SUPABASE_URL = 'https://jythapadyguuktsrkjxv.supabase.co';
      const SUPABASE_KEY = 'sb_publishable_fQTr0pmHRwQq4HEMu5J66A_EVHEN7ln';
      const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

      const editableElements = document.querySelectorAll('[contenteditable="true"]');
      const syncStatus = document.getElementById('sync-status');

      // CHARGER LES DONNÃ‰ES
      async function loadData() {
        const { data, error } = await supabaseClient
          .from('content')
          .select('data')
          .eq('id', 1)
          .single();

        if (data && data.data) {
          editableElements.forEach((el, index) => {
            if (data.data[index]) el.innerHTML = data.data[index];
          });
        }
        initChart();
        calculate();
      }

      // SAUVEGARDER LES DONNÃ‰ES
      async function saveData() {
        syncStatus.style.opacity = 1;
        syncStatus.textContent = "âŒ› Sauvegarde...";
        
        let contentToSave = {};
        editableElements.forEach((el, index) => {
          contentToSave[index] = el.innerHTML;
        });

        const { error } = await supabaseClient
          .from('content')
          .update({ data: contentToSave })
          .eq('id', 1);

        if (!error) {
          syncStatus.textContent = "âœ“ SynchronisÃ©";
          setTimeout(() => syncStatus.style.opacity = 0, 2000);
        }
      }

      // CALCULATEUR & GRAPHIQUE
      const costInput = document.getElementById("costInput");
      const priceInput = document.getElementById("priceInput");
      const salesInput = document.getElementById("salesInput");
      let scenarioChart;

      function initChart() {
        const ctx = document.getElementById("scenarioChart").getContext("2d");
        scenarioChart = new Chart(ctx, {
          type: "bar",
          data: {
            labels: ["Pessimiste", "RÃ©aliste", "Optimiste"],
            datasets: [{ label: "Profit (CHF)", data: [0, 0, 0], backgroundColor: ["#ef4444", "#3b82f6", "#10b981"] }]
          },
          options: { responsive: true, maintainAspectRatio: false }
        });
      }

      function calculate() {
        const cost = parseFloat(costInput.value);
        const price = parseFloat(priceInput.value);
        const sales = parseInt(salesInput.value);
        
        document.getElementById("costVal").textContent = cost.toFixed(2);
        document.getElementById("priceVal").textContent = price.toFixed(2);
        document.getElementById("salesVal").textContent = sales;

        const profit = (price - cost) * sales;
        const netProfitEl = document.getElementById("netProfit");
        netProfitEl.textContent = profit.toFixed(2) + " CHF";
        netProfitEl.className = profit >= 0 ? "stat-val profit" : "stat-val loss";

        if (scenarioChart) {
            scenarioChart.data.datasets[0].data = [profit * 0.5, profit, profit * 1.3];
            scenarioChart.update();
        }
      }

      // LISTENERS
      window.onload = loadData;
      editableElements.forEach(el => el.addEventListener('blur', saveData));
      [costInput, priceInput, salesInput].forEach(input => input.addEventListener("input", calculate));
    </script>
  </body>
</html>
